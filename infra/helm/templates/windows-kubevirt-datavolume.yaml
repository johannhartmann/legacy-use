{{- if and .Values.windowsKubevirt.enabled .Values.windowsKubevirt.dataVolumeTemplate.enabled -}}
apiVersion: cdi.kubevirt.io/v1beta1
kind: DataVolume
metadata:
  name: {{ include "legacy-use.fullname" . }}-windows-dv
  labels:
    {{- include "legacy-use.labels" . | nindent 4 }}
    app.kubernetes.io/component: windows-kubevirt
spec:
  source:
    {{- if .Values.windowsKubevirt.dataVolumeTemplate.source.http }}
    http:
      url: {{ .Values.windowsKubevirt.dataVolumeTemplate.source.http.url }}
    {{- else if .Values.windowsKubevirt.dataVolumeTemplate.source.registry }}
    registry:
      url: {{ .Values.windowsKubevirt.dataVolumeTemplate.source.registry.url }}
    {{- else if .Values.windowsKubevirt.dataVolumeTemplate.source.pvc }}
    pvc:
      name: {{ .Values.windowsKubevirt.dataVolumeTemplate.source.pvc.name }}
      namespace: {{ .Values.windowsKubevirt.dataVolumeTemplate.source.pvc.namespace }}
    {{- end }}
  pvc:
    accessModes:
      - {{ .Values.windowsKubevirt.persistence.accessMode }}
    {{- if .Values.windowsKubevirt.persistence.storageClass }}
    {{- if (eq "-" .Values.windowsKubevirt.persistence.storageClass) }}
    storageClassName: ""
    {{- else }}
    storageClassName: {{ .Values.windowsKubevirt.persistence.storageClass | quote }}
    {{- end }}
    {{- end }}
    resources:
      requests:
        storage: {{ .Values.windowsKubevirt.persistence.size }}
{{- end }}